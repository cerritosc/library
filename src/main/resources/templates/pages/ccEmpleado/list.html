<!--decorated page-->
<html lang="en" dir="ltr" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layouts/basic-layout}">

<head>
    <title th:inline="text" th:text="#{label.list} + ' ' + 'Empleado'"></title>

    <!-- Custom CSS from main page-->
</head>

<body>
<section layout:fragment="content" th:remove="tag">
<div class="container-fluid">
    <div class="header">
        <h1 class="header-title" th:inline="text" th:text="#{label.list} + ' ' + 'Empleado'"></h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/index}" th:inline="text" th:text="#{label.home}"></a></li>
                <li class="breadcrumb-item active" aria-current="page" th:inline="text" th:text="#{label.list} + ' '  + 'Empleado'"></li>
            </ol>
        </nav>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <th:block th:insert="fragments/service-response-painter" th:remove="tag"/>
                    <div class="card-title col-lg-2">
                        <a class="btn btn waves-effect waves-light btn-block btn-info"
                           th:href="@{/ccEmpleado/form}" th:inline="text">
                            <i class="fa fa-plus-circle pr-1"></i>[[#{action.new}]]
                        </a>
                    </div>
                    <div class="table-responsive">
                        <table id="tblCcEmpleado" class="table table-hover table-bordered" width="100%">
                            <thead>
                            <tr>
                                <th>Acciones</th>
                                <th>skEmpleado</th>
                                <th>Nombres</th>
                                <th>Apellidos</th>
                                <th>ccRolSkRolDelegate</th>
                                <th>Rol</th>
                                <th>ccEmpleadoSkEmpleadoDelegate</th>
                                <th>Supervisor</th>
                                <th>Estado</th>
                            </tr>
                            </thead>
                        </table>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
</section>

<section layout:fragment="js" th:remove="tag">
    <!-- Required libraries -->

    <script th:inline="javascript">
        const urlCcUsuarioSelect2 = /*[[@{/ccUsuario/cboFilterS2}]]*/"";
        const urlCcRolSelect2 = /*[[@{/ccRol/cboFilterS2}]]*/"";
        const urlCcEmpleadoSelect2 = /*[[@{/ccEmpleado/cboFilterS2}]]*/"";
        const urlCcEmpleadoDataTable = /*[[@{/ccEmpleado/list}]]*/"";
        const urlGetCcEmpleado = /*[[@{/ccEmpleado/form}]]*/"";
        const urlDeleteCcEmpleado = /*[[@{/ccEmpleado/delete}]]*/"";
        
        const urlEstadoBinario = /*[[@{/comboEstado/cboFilterTrueFalse}]]*/"";
        const urlActivarEmpleado = /*[[@{/ccEmpleado/activar}]]*/"";
        const urlInactivarEmpleado = /*[[@{/ccEmpleado/inactivar}]]*/"";
        
        // permisos
//        const permisoCrearEmpleado = /*[[${#authorization.expression('hasAuthority(''OP_CREATE_EMPLEADO'')')}]]*/"";
//        const permisoEditarEmpleado = /*[[${#authorization.expression('hasAuthority(''OP_EDIT_EMPLEADO'')')}]]*/"";
//        const permisoBorrarEmpleado = /*[[${#authorization.expression('hasAuthority(''OP_DELETE_EMPLEADO'')')}]]*/"";
//        const permisoActivarEmpleado = /*[[${#authorization.expression('hasAuthority(''OP_ACTIVATE_EMPLEADO'')')}]]*/"";


        const permisoCrearEmpleado = true;
        const permisoEditarEmpleado = true;
        const permisoBorrarEmpleado = true;
        const permisoActivarEmpleado = true;
    </script>
    <script>
        var table = $('table#tblCcEmpleado').DataTable({
            ajax: urlCcEmpleadoDataTable,
            serverSide: true,
            orderCellsTop: true,
            fixedHeader: true,
            columns: [
                {
                    targets: -1,
                    data: null,
                    searchable: false,
                    orderable: false,
                    width: "10%",
                    render: function (data, type, row) {
                        var id = row.skEmpleado;
                        var botones = '<div class="button-group" style="display: inline-flex;">';
                        if(permisoEditarEmpleado) {
                            botones += '<button title="Editar" class="btn waves-effect waves-light btn-success" type="button" onClick="ajaxEdit(' + id + ')" id="btnEditar_' + id + '" > <i class="fa fa-pencil-alt"></i></button>';
                        }
                                    
                        if(row.bnEstado && permisoActivarEmpleado) {
                            botones += '<button title="Inactivar registro" class="btn waves-effect waves-light btn-danger" type="button" onClick="ajaxInactivar(' + id + ')" id="btnInactivar_' + id + '" > <i class="fas fa-ban"></i> </button>';
                        }
                        else {
                            if(permisoBorrarEmpleado) {
                                botones += '<button title="Eliminar" class="btn waves-effect waves-light btn-danger" type="button" onClick="ajaxDelete(' + id + ')" id="btnEliminar_' + id + '" > <i class="fa fa-trash"></i> </button>';
                            }
                            if(permisoActivarEmpleado) {
                                botones += '<button title="Activar registro" class="btn waves-effect waves-light btn-info" type="button" onClick="ajaxActivar(' + id + ')" id="btnActivar_' + id + '" > <i class="fas fa-check"></i> </button>';
                            }
                        }
                        botones += '</div>';
                        return botones;
                    }
                }
                , {
                    data: 'skEmpleado',
                    orderable: false
                    , visible: false
                    , searchable: false
                }
                , {
                    data: 'stNombres'
                    , orderable: false
                }
                , {
                    data: 'stApellidos'
                    , orderable: false
                }
                , {
                    data: 'ccRolSkRolDelegate',
                    searchable: false,
                    visible: false
                }       
                , {
                    data: 'ccRol.skRol',
                    render: function (data, type, row) {
                        return row.ccRolStDescripcionDelegate;
                    },
                    orderable: false,
                    filterType: "select2",
                    filterUrl: urlCcRolSelect2
                }
                , {
                    data: 'supervisorIdDelegate',
                    searchable: false,
                    visible: false
                }       
                , {
                    data: 'ccSupervisor.skEmpleado',
                    render: function (data, type, row) {
                        return row.supervisorStDescripcionDelegate;
                    },
                    orderable: false,
                    filterType: "select2",
                    filterUrl: urlCcEmpleadoSelect2
                }
                , {
                    data: 'bnEstado'
                    , orderable: false
                    , filterType: "select2"
                    , filterUrl: urlEstadoBinario
                    , render: function (data, type, row) {
                        return row.estadoVisible;
                    }
                }
            ]
        });

        crearFiltrosDataTable("#tblCcEmpleado", table);

        table.findById = function(id) {
            return this.data()
                .filter( function ( value, index ) {
                    return parseInt(id) === parseInt(value.skEmpleado);
            })[0];
        };

        //Ajax Edit
        function ajaxEdit(id){
            document.location.href = urlGetCcEmpleado + '?skEmpleado=' + id;
        }

        //Ajax Delete
        function ajaxDelete(id){
            var skEmpleado = id;
            Swal.fire({
                title: '¿Está seguro?',
                text: "Se eliminará el registro",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si',
                cancelButtonText: 'No'
            }).then(function(e) {
                if (e.value === true) {
                    $.ajax({
                        data: {skEmpleado : skEmpleado} ,
                        url: urlDeleteCcEmpleado,
                        type: 'POST',
                        success: function (result) {
                            if (result.success === true) {
                                Swal.fire({title: "¡Eliminado!", text: result.message, type:'success'});
                                $('#tblCcEmpleado').DataTable().ajax.reload();
                            } else {
                                Swal.fire({title: "¡Error!", text: result.message, type:'error'});
                            }
                        },
                        error: function (x, e,  thrownError) {
                            Swal.fire({title: "¡Error!", text: "Error interno del servidor.", type:'error'});
                        }
                    });
                }
            });
        }
        
        function ajaxActivar(id) {
            Swal.fire({
                title: '¿Está seguro?',
                text: "¿Desea activar al empleado?",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si',
                cancelButtonText: 'No'
            }).then(function(e) {
                if (e.value === true) {
                    var data = new PeticionData({skEmpleado: id}, urlActivarEmpleado, "POST");
                    data.procesarPeticionAjax(function(result) {
                        Swal.fire({title: "¡Activado!", text: result.message, type:'success'});
                        table.ajax.reload();
                    });
                }
            });
        }
        
        function ajaxInactivar(id) {
            Swal.fire({
                title: '¿Está seguro?',
                text: "¿Desea inactivar al empleado?",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si',
                cancelButtonText: 'No'
            }).then(function(e) {
                if (e.value === true) {
                    var data = new PeticionData({skEmpleado: id}, urlInactivarEmpleado, "POST");
                    data.procesarPeticionAjax(function(result) {
                        Swal.fire({title: "¡Inactivado!", text: result.message, type:'success'});
                        table.ajax.reload();
                    });
                }
            });
        }
    </script>
</section>
</body>

</html>
